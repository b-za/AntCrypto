This system processes crypto trading history CSV files to generate detailed FIFO (First-In-First-Out) inventory tracking reports for tax purposes. It categorizes transactions into Buy, Sell, Fee, and Other, applies FIFO for cost basis calculation, and produces reports per currency and financial year.

## System Setup and File Structure
- **Root Directory:** `Crypto Ant/`
- **Input Data:** Place CSV files in `data/` subdirectory. Each CSV must have headers: Timestamp (UTC), Description, Reference, Value amount, Balance delta, Currency. Files are named like `ltc.csv`, `eth.csv`, etc.
- **Scripts:** Located in `scripts/` subdirectory.
  - `main.py`: **Orchestrator script** - runs all other scripts in the correct order.
  - `identify_buys_for_others.py`: Analyzes data to find buys made specifically for Others (transfers/sends).
  - `fifo_report.py`: Main script for processing data and generating FIFO/FY reports.
  - `overview_report.py`: Script to generate overview summary from FY reports.
  - `prompt.md`: This documentation.
- **Generated Data:**
  - `data/buys_for_others.json`: Mapping of buy lot refs to their matched Others (generated by identify_buys_for_others.py).
- **Output Directory:** Reports are generated in `reports/` subdirectory, in a new timestamped subfolder (e.g., `2025_12_19_0725/`) each run to avoid overwriting.
- **Dependencies:** Requires Python 3 with `decimal`, `csv`, `datetime`, `collections`, `json` modules (standard library).

## Workflow for New Agents
1. **Place Data:** Ensure CSV files are in `data/`. If new data arrives, add/update CSVs there.
2. **Run Main Script:** From `scripts/` directory, execute `python main.py`. This runs all scripts in order:
   - First: `identify_buys_for_others.py` - identifies buys made for Others
   - Second: `fifo_report.py` - generates FIFO and FY reports
   - Third: `overview_report.py` - generates overview summary
3. **Review Outputs:** Check the timestamped reports folder for all generated CSVs. Use for tax filing or analysis.

**Alternative:** You can still run scripts individually if needed:
- `python identify_buys_for_others.py` - must run first if you want direct buy-to-other assignment
- `python fifo_report.py` - generates reports
- `python overview_report.py` - generates overview

## Processing Logic Overview
Refer to `fifo_report.py` for full implementation details. Key points:
- **Data Prep:** Sorts by timestamp; calculates FY (March-Feb).
- **Categorization:** Based on Balance delta and Description keywords (e.g., 'Bought' for buys, 'Sold' for sells, 'fee' for fees).
- **Buys for Others:** The system identifies buys made specifically for Others (transfers/sends) based on:
  - Time proximity: Buy occurs within 7 days before the Other
  - Quantity match: Other consumes â‰¥90% of the buy quantity
  - These buys are assigned directly to their matched Others instead of using FIFO
- **FIFO:** Regular buys create lots; sells consume oldest lots first. Others use their matched buy lot if identified, otherwise fall back to FIFO.
- **Outputs:** See below for formats. Scripts handle edge cases like empty lots or remaining quantities.

## Output Formats

### Individual Currency FIFO Reports (e.g., ltc_fifo.csv)
Detailed per-transaction CSV with columns as defined in `fifo_report.py` (Type, Qty Change, etc.). Tracks running balances.

### Financial Year Reports (e.g., fy2021_report.csv)
Structured CSV with sections for:
- **Boughts for FY**: Regular buys (not matched to Others)
- **Solds for FY**: Sales with FIFO lot assignment
- **Buys for Others FY**: Buys specifically identified as being for Others (transfers/sends)
- **Others for FY**: Transfers, sends, and other outflows with their assigned lots
- **Balances**: End-of-year holdings per currency
- **Fees**: Categorized by Buying, Selling, Other

### Overview Report (overview_report.csv)
Aggregated summary per FY: Gains/losses, net profit, total value, asset balances. Generated by `overview_report.py` parsing FY reports.

## Important Notes
- Always run `python main.py` to execute the full pipeline in the correct order.
- If data changes, re-run `python main.py` to regenerate all reports.
- Scripts assume data integrity; validate CSVs for correct formats.
- For code details, read `fifo_report.py`, `identify_buys_for_others.py`, and `overview_report.py` directly.